function trialmove:
    i = random number from 0 to total_n_atoms
    en_0 = energy(x_i, i) -> energy of atom i
    x_new = x_i + (R-0.5)*step_size
    en_new = energy(x_new, i)

    if R<exp(-beta*(en_new-en_0))
        accept
    else
        reject and revert to x_i

function energy:
    for 1<= j <= total_n_atoms-1
        if i != j
            dr = x_i - x_j
            dr = dr - box*round(dr/box)
            r2 = dr*dr
            if r2 < rc2
                PE formula
    return PE

function widom:
    w_test = wtest + exp(-β * entest)
    μex = − ln(wtest/M)/β

function MC:
    for 1<= i <= n_insert
        trialmove
        if i%1000 == 0
            if (acceptance_ratio < 0.3)
                step_size *= 0.9; // Decrease step size
            else if (acceptance_ratio > 0.5)
                step_size *= 1.1; // Increase step size    
            widom
    